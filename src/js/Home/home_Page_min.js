document.addEventListener("DOMContentLoaded",(()=>{const e=e=>document.querySelector(e),t=e=>document.querySelectorAll(e),s=(e,t,s)=>{const o=document.createElement(e);return t&&(o.className=t),s&&(o.innerHTML=s),o},o=s("div","toast-container");document.body.appendChild(o);const n=(e,t="error")=>{const n=s("div",`toast ${t}`,e);o.appendChild(n),setTimeout((()=>n.style.opacity="1"),50),setTimeout((()=>{n.style.opacity="0",setTimeout((()=>n.remove()),300)}),3e3)},r=e=>{for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}return e},c=t(".slide");let a=0;const i=e=>{c.forEach(((t,s)=>t.classList.toggle("active",s===e)))},l=()=>{a=(a+1)%c.length,i(a)};c.length&&(i(a),setInterval(l,5e3));const d=e("#carousel"),v=e("#prev-btn"),h=e("#next-btn");let p;const g=e=>{d.innerHTML="",e.forEach(((e,t)=>{const o=s("div","card",`\n        <img src="${n=e.ID,`./src/assets/images/${n}.jpg`}" alt="${e.Name}"\n             onerror="this.src='./src/assets/images/default.jpg';" />\n        <div class="card-content">\n          <h3 class="type">${e.Type}</h3>\n          <p class="name">${e.Name}</p>\n          <p class="price">â‚¹${e.PricePerKg}/kg</p>\n        </div>\n      `);var n;o.style.opacity="0",o.style.transform="translateY(20px)",d.appendChild(o),setTimeout((()=>{o.style.opacity="1",o.style.transform="translateY(0)"}),100*(t+1))}))},m=()=>{const e=d.scrollWidth-d.clientWidth;v.disabled=d.scrollLeft<=0,h.disabled=d.scrollLeft>=e},u=e=>{const t=d.querySelector(".card")?.offsetWidth||(window.innerWidth<=768?180:240);d.scrollBy({left:e*(t+16),behavior:"smooth"}),setTimeout(m,300)},f=()=>{clearInterval(p);const e=d.querySelector(".card")?.offsetWidth||(window.innerWidth<=768?180:240);let t=0;p=setInterval((()=>{d.scrollBy({left:e+16,behavior:"smooth"}),t+=e+16,t>=d.scrollWidth-d.clientWidth&&(t=0,d.scrollTo({left:0,behavior:"smooth"})),m()}),3500)},y=async()=>{if(navigator.onLine||(n("No internet connection"),0)){(()=>{d.innerHTML="";for(let e=0;e<5;e++)d.appendChild(s("div","skeleton-card",'\n          <div class="skeleton-img"></div>\n          <div class="skeleton-text"></div>\n          <div class="skeleton-text"></div>\n          <div class="skeleton-text short"></div>\n          <div class="skeleton-text short"></div>\n        '))})();try{const e=await fetch("https://script.google.com/macros/s/AKfycbzWIlg4U6L71j2jIOxt0Jh6EKvUSDbvrKf7F4AtsbLzY5_YZXjCj_nJ-0wMOjkpHY-G/exec",{cache:"no-store"});if(!e.ok)throw new Error(`HTTP error! Status: ${e.status}`);const t=await e.json(),s=(Array.isArray(t)?t.slice(0,10):[]).map((e=>({ID:String(e.ID||""),Brand:String(e.Brand||"N/A"),Name:String(e.Name||"N/A"),Type:String(e.Type||"N/A"),PricePerKg:parseFloat(e.PricePerKg)||0})));if(!s.length)throw new Error("No valid product data received");const o=r([...s]);sessionStorage.setItem("carouselProducts",JSON.stringify(o)),n("Carousel products saved to session storage","success"),g(o),m(),f()}catch(e){console.error(e),d.innerHTML=`<p style="padding:10px; color: var(--color-error);">Unable to load products: ${e.message}</p>`}}else d.innerHTML='<p style="padding:10px; color: var(--color-error);">No internet connection</p>'};v?.addEventListener("click",(()=>u(-1))),h?.addEventListener("click",(()=>u(1))),d?.addEventListener("scroll",m),d?.addEventListener("mouseenter",(()=>clearInterval(p))),d?.addEventListener("mouseleave",f);const L=sessionStorage.getItem("carouselProducts");if(L)try{g(r(JSON.parse(L))),m(),f(),n("Loaded carousel products from cache","success")}catch{y()}else y();window.addEventListener("online",(()=>{n("Back online","success"),y()})),window.addEventListener("offline",(()=>n("Lost internet connection")));const w=new IntersectionObserver((e=>{e.forEach(((e,t)=>{e.isIntersecting&&(setTimeout((()=>e.target.classList.add("visible")),200*t),w.unobserve(e.target))}))}),{threshold:.2});[...t(".timeline-step"),e(".section-title"),...t(".category-card"),...t(".value-card")].filter(Boolean).forEach((e=>w.observe(e)));const E=()=>{const e=.85*window.innerHeight;t(".category-card").forEach((t=>{t.getBoundingClientRect().top<e&&t.classList.add("show")}))};window.addEventListener("scroll",E),E()}));