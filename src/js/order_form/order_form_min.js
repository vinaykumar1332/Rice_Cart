const scriptURL="https://script.google.com/macros/s/AKfycbxs1Vigr-HLZO1co-Ht6itcH_49kRbzJE_QLFMz0AkvTVPFICsF8bbz59qsJWhnGrXU/exec",form=document.forms["submit-to-google-sheet"],loader=document.getElementById("loader"),submitBtn=form.querySelector('button[type="submit"]');let locationCaptured=!1;const fields={name:document.getElementById("name"),mobile:document.getElementById("mobile"),address:document.getElementById("address"),terms:document.getElementById("ex"),brand:document.getElementById("brand"),bags:document.getElementById("bags"),weightPerBag:document.getElementById("weightPerBag"),basePrice:document.getElementById("basePrice"),totalPrice:document.getElementById("totalPrice"),orderId:document.getElementById("orderId"),productId:document.getElementById("productId"),latitude:document.getElementById("latitude"),longitude:document.getElementById("longitude"),mapsUrl:document.getElementById("mapsUrl")};function getLocation(){const e=document.querySelector(".location-btn");loader.style.display="flex",e.disabled=!0,navigator.geolocation?navigator.geolocation.getCurrentPosition((({coords:t})=>{const{latitude:n,longitude:o}=t;fields.latitude.value=n??"Unavailable",fields.longitude.value=o??"Unavailable",fields.mapsUrl.value=`https://www.google.com/maps?q=${n},${o}`,locationCaptured=!0,Swal.fire({icon:"success",title:"Location Captured",timer:1e3,showConfirmButton:!1}),loader.style.display="none",e.disabled=!1}),(e=>{handleLocationError(getErrorMessage(e)),fields.latitude.value=fields.longitude.value=fields.mapsUrl.value="Unavailable",locationCaptured=!1}),{timeout:5e3}):handleLocationError("Geolocation is not supported by this browser.")}function handleLocationError(e){Swal.fire({icon:"error",title:"Error",text:e,timer:1500,showConfirmButton:!1}),loader.style.display="none",document.querySelector(".location-btn").disabled=!1}function getErrorMessage(e){switch(e.code){case e.PERMISSION_DENIED:return"Location access denied.";case e.POSITION_UNAVAILABLE:return"Location unavailable.";case e.TIMEOUT:return"Location request timed out.";default:return"Unable to capture location."}}function validateForm(){let e=!0;return fields.mobile.value.match(/^\d{10}$/)?clearError(fields.mobile):(showError(fields.mobile,"Enter a valid 10-digit mobile number."),e=!1),fields.address.value.trim()?clearError(fields.address):(showError(fields.address,"Address is required."),e=!1),fields.terms.checked?clearError(fields.terms):(showError(fields.terms,"You must agree to the Terms."),e=!1),e||Swal.fire({icon:"warning",title:"Invalid Input",text:"Please correct the errors.",timer:1500,showConfirmButton:!1}),e}function showError(e,t){e.classList.add("is-invalid");const n=e.parentElement.querySelector(".invalid-feedback")||Object.assign(document.createElement("div"),{className:"invalid-feedback"});n.innerText=t,e.parentElement.appendChild(n)}function clearError(e){e.classList.remove("is-invalid");const t=e.parentElement.querySelector(".invalid-feedback");t&&(t.innerText="")}function disableForm(){[fields.brand,fields.bags,fields.weightPerBag,fields.basePrice,fields.totalPrice].forEach((e=>{e.value="No items in cart",e.classList.add("text-muted")})),fields.orderId.value="",submitBtn.disabled=!0}function generateOrderID(){return Array.from({length:10},(()=>"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"[Math.floor(62*Math.random())])).join("")}function showThankYouOverlay(e){const t=document.createElement("div");t.style.cssText="\n    position: fixed;\n    top: 0; left: 0; right: 0; bottom: 0;\n    background: #ffffff;\n    z-index: 9999;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    padding: 20px;\n    animation: fadeIn 0.5s ease-in-out;\n  ",t.innerHTML='\n    <style>\n      @keyframes fadeIn {\n        from { opacity: 0; transform: scale(0.9); }\n        to { opacity: 1; transform: scale(1); }\n      }\n      .thank-you-box {\n        max-width: 400px;\n        background: #f9f9f9;\n        padding: 30px;\n        border-radius: 15px;\n        box-shadow: 0 5px 15px rgba(0,0,0,0.2);\n        text-align: center;\n        animation: fadeIn 0.5s ease;\n      }\n      .thank-you-box h2 {\n        margin-bottom: 10px;\n        color: #28a745;\n        font-size: 26px;\n      }\n      .thank-you-box p {\n        margin: 10px 0;\n        color: #444;\n      }\n      .thank-you-buttons {\n        margin-top: 20px;\n        display: flex;\n        flex-direction: column;\n        gap: 10px;\n      }\n      .thank-you-buttons a {\n        text-decoration: none;\n        background: #007bff;\n        color: white;\n        padding: 10px 15px;\n        border-radius: 8px;\n        font-weight: bold;\n        transition: background 0.3s;\n      }\n      .thank-you-buttons a:hover {\n        background: #0056b3;\n      }\n      @media (max-width: 480px) {\n        .thank-you-box {\n          width: 100%;\n          padding: 20px;\n        }\n      }\n    </style>\n    <div class="thank-you-box">\n      <h2>üéâ Order Placed Successfully!</h2>\n      <p>Your order has been received and is being processed.</p>\n          <div class="thank-you-buttons">\n        <a href="https://vinaykumar1332.github.io/Rice_Cart/myOrders.html">üîç Track Order</a>\n        <a href="https://vinaykumar1332.github.io/Rice_Cart/product.html">Continue Shopping</a>\n      </div>\n    </div>\n  ',document.body.appendChild(t),form.reset(),fields.latitude.value=fields.longitude.value=fields.mapsUrl.value=fields.productId.value="",locationCaptured=!1}function showOverlay(e,t){const n=document.getElementById("overlay");document.getElementById("overlayText").innerHTML=`<h3>${e}</h3>${t}`,n.style.display="flex"}form.addEventListener("submit",(e=>{if(e.preventDefault(),!validateForm())return;if(!locationCaptured)return void Swal.fire({icon:"warning",title:"Location Required",text:"Please share your location.",timer:1500,showConfirmButton:!1});loader.style.display="flex",submitBtn.disabled=!0;const t=new FormData(form);t.append("Terms Agreed",fields.terms.checked?"Yes":"No"),fetch(scriptURL,{method:"POST",body:t}).then((()=>{sessionStorage.removeItem("cart"),showThankYouOverlay(fields.orderId.value)})).catch((()=>Swal.fire({icon:"error",title:"Error",text:"Submission failed. Try again!",timer:1500,showConfirmButton:!1}))).finally((()=>{loader.style.display="none",submitBtn.disabled=!1}))})),fields.mobile.addEventListener("input",(()=>{fields.mobile.value=fields.mobile.value.replace(/\D/g,"").slice(0,10)})),window.addEventListener("DOMContentLoaded",(()=>{const e=JSON.parse(sessionStorage.getItem("cart"))||[];if(0===e.length)return void disableForm();const t=e[0],n=t.weightPerBag*t.bags*t.basePrice;fields.productId.value=t.id,fields.brand.value=t.brand,fields.bags.value=t.bags,fields.weightPerBag.value=`${t.weightPerBag} kg`,fields.basePrice.value=`‚Çπ${t.basePrice}`,fields.totalPrice.value=`‚Çπ${n.toLocaleString()}`,fields.orderId.value=generateOrderID()})),document.getElementById("showTerms").addEventListener("click",(function(e){e.preventDefault(),showOverlay("Terms of Service","\n    <p>These are the terms of service. Please read them carefully before agreeing to proceed with the service.</p>\n    <ul>\n      <li>No unauthorized use.</li>\n      <li>Respect user privacy.</li>\n      <li>Comply with applicable laws.</li>\n    </ul>\n  ")})),document.getElementById("showPrivacy").addEventListener("click",(function(e){e.preventDefault(),showOverlay("Privacy Policy","\n    <p>This privacy policy explains how we handle your data.</p>\n    <ul>\n      <li>We do not sell your information.</li>\n      <li>Data is stored securely.</li>\n      <li>You have control over your data.</li>\n    </ul>\n  ")})),document.getElementById("closeOverlay").addEventListener("click",(function(){document.getElementById("overlay").style.display="none"}));